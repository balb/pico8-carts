pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
gpos=0
cspr=2

jeffx=24
starty=112
jeffy=starty

jumping=false
startthrust=5
thrust=startthrust
gravity=0.6

slap=0
slaptime=5

enemyx=100
dead=false

temp=flr(rnd(10))

function _init()
	-- palt(15, true) -- beige
	-- palt(0, false) -- black
	gen_plts()
end

function _update()
	-- ground
	gpos-=1
	if gpos==-8 then
		gpos=0
	end
	if gpos%2==0 then
		cspr+=1
	end
	-- jeff
	if cspr==5 then
		cspr=2
	end

	handle_jump()
	
	if btnp(4) then
 	slap=slaptime
 end
 
 enemyx-=1
end

function _draw()
	cls()
	
	-- blue background
	-- rectfill(0,0,127,119,12)
	
	-- ground
	--for i=0,16 do
	--	spr(1,i*8+gpos,120)
	--end
	
	-- jeff
	spr(cspr,jeffx,jeffy)
	
	if slap>0 then
		spr(5,32,jeffy)
		slap-=1
	end
	-- enemy - hi isaac!
	spr(19,enemyx,112)
	
	--for k,v in pairs(plts) do
	--	print(v[1].." "..v[2],10,10+k*8,0)
	--end
	draw_plts()
	
	--draw moon
	circfill(100,20,10,6)
	circfill(92,20,10,0)
	
	 print(dead,10,10,10)

end
-->8
-- jumping
floor=0

function handle_jump()
 if btnp(2) then
 	jumping=true
 end
 
 local jeff_oset=jeffx/8
 floor=120-
 	plts[jeff_oset+plt_oset]*8
  
 if jumping then
 	jeffy-=thrust
 	thrust-=gravity
 	if jeffy >= floor then
 		jeffy=floor
 		thrust=startthrust
 		jumping=false
 	end
 elseif floor==120 then
 	--fall
 	dead=true
 end
 
 if dead then
 	jeffy+=thrust
 	if jeffy>128 then
 		-- restart
 		dead=false
 	end
 end
end
-->8
-- paltforms
plts={}
plt_oset=1
plt_count=0
plt_top=128

function gen_plts()
	local level=1
	local len=10
	for i=1,99 do
	 for j=1,len do
	 	add(plts,level)
	 end
	 
	 -- gap
	 add(plts,0)
		
		local d=flr(rnd(99))%3
		if d==2 and level<7 then
			level+=1
		elseif d==1 and level>1 then
			level-=1
		end
		
		len=flr(rnd(5))+3
	end
end

function draw_plts()
	for i=0,16 do
	 local p=plts[i+plt_oset]
		if p!=0 then
			spr(6,i*8-plt_count,
				plt_top-p*8)
		end
	end
	
	if plt_count==7 then
		plt_oset+=1
		plt_count=0
	else
		plt_count+=1
	end
end
__gfx__
000000009994999400aaaaaa00aaaaaa00aaaaaa0008880088e8888e000000000000000000000000000000000000000000000000000000000000000000000000
00000000999499940aaa88880aaa88880aaa88880088000088e8888e000000000000000000000000000000000000000000000000000000000000000000000000
00700700444444440aa887180aa887180aa8871808888888eeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000
0007700049994999aa888118aa888118aa88811888880000e88e8888000000000000000000000000000000000000000000000000000000000000000000000000
0007700049994999aa888888aa888888aa88888888888888e88e8888766666660000000000000000000000000000000000000000000000000000000000000000
0070070044444444aa888880aa888880aa88888088880000eeeeeeee666667760000000000000000000000000000000000000000000000000000000000000000
0000000094999499055005505500055055005500088888808e88e888667666660060000000000000000000000000000000000000000000000000000000000000
0000000094999499055505555550055555505550000000008e88e888676666670000000000000000000000000000000000000000000000000000000000000000
000000000bbbbb000000000000000000455555544cc66cc400000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbaaaaa000000c00c04cccccc44cccccc400000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbba8888a0000c0cc0c4cccccc45ccc7cc500000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbba71888a00c00000c4cccc7c45cc7ccc500000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000bbbbb0a11888a00c70070c5ccc7cc55cccccc500000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000055000a88888a00c00000c4cccccc45cccccc500000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000055000a88888a000c0000c4cccccc44cccccc400000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000550000a8888a0000cccc0444664444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000004cc66cc40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000004cccccc40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000005ccc7cc50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000005cc7ccc50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000005cccccc50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000005cccccc50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000004cccccc40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
